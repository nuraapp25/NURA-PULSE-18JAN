<analysis>
The AI engineer successfully progressed the Nura Pulse application from MVP to a more feature-rich product. Key achievements include enhancing the Driver Onboarding with detailed forms, hierarchical statuses, and multi-format file imports, including a two-way Google Sheets sync. A Ride Deck Data Analysis feature was built, calculating distances via Google Maps and later expanded with customer/ride data imports, locality extraction refinements, and pagination. New functionalities like Cancellation RCA and Driver_Not_Found RCA tables, customizable Ride Status and SignUps analytics dashboards, and an App Enable/Disable toggle for the Payment Data Extractor were implemented. Document upload with OCR for driver leads was initiated. Debugging involved fixing backend URL issues, Excel date conversions, locality extraction logic, and ensuring proper sync functionality. The current focus is on debugging a failure in the Payment Data Extractor when processing multiple images.
</analysis>

<product_requirements>
The Nura Pulse application is a business data dashboard with authentication and role-based access, continually expanding its functionality. It includes:
1.  **Expense Tracker:** Mini-app for expense management (partially implemented).
2.  **Payment Data Extractor:** Processes screenshot for tabular analysis, now with parallel processing, loading animations, and Google Sheets sync. Recently, an enable/disable toggle was added for Master Admins, and editing is restricted to Admin/Master Admin roles.
3.  **Hotspot Planning:** CSV trip data upload for optimal pickup location identification via K-Means clustering.
4.  **Driver Onboarding Two-Way Sync:** Auto-sync between app and Google Sheets. UI/UX improvements: hierarchical statuses, inline editing, Lead Source and Date inputs for imports, multi-format file support. Expanded fields for driver forms now include document uploads and OCR scanning for data extraction.
5.  **QR Code Management System (Master Admins only):** Dynamic QR code creation, scan data tracking, and analytics.
6.  **Ride Deck Data Analysis (NEW):**
    *   **Initial:** Upload XLSX, calculate Google Maps travel distances (pickup/drop).
    *   **Enhanced:** Extracts Pickup Locality, Pickup Time, Drop Locality, Drop Time from addresses.
    *   **New Data Import & Analysis:** Import Customer Data and Import Ride Data from CSV (upsert by 'id'). Computes derived fields (e.g., Most Common Pickup Point). Added view, download, delete data functionality with pagination. Locality extraction refined to show only specific parts.
7.  **RCA Management (NEW):** Two tables (Cancellation RCA and Driver_Not_Found RCA) displaying filtered ride data. Allows Ops to select Status Reason from a dropdown and enter Status Detail with conditional validation.
8.  **Analytics Dashboards (NEW):** Ride Status and SignUps pivot tables from ride and customer databases, with date, status, source fields, and count/sum/average aggregation. Includes a Pivot Table Editor. Converts UTC timestamps to IST.
9.  **User Activity Analytics (NEW):** A dashboard to see user actions history and live feed, with data stored in backend.
</product_requirements>

<key_technical_concepts>
-   **Full-stack**: React (Shadcn UI, Tailwind CSS, Chart.js), FastAPI, MongoDB.
-   **Auth & Authz**: JWT for role-based access control.
-   **Geospatial**: Google Maps API, K-Means clustering.
-   **LLM Integration**: OpenAI GPT-4o Vision, Emergent LLM Key.
-   **Google Sheets**: Two-way sync via Apps Script, webhooks.
-   **Data Processing**: Pandas for Excel/CSV parsing, asynchronous processing.
</key_technical_concepts>

<code_architecture>

-   ****: Core FastAPI backend.
    -   **Summary**: Handles API routes for various features.
    -   **Changes**: Added/modified logic for Driver Onboarding lead imports (Format 3, Lead Generator). Expanded webhook sync. New endpoints for  (Google Maps integration, customer/ride data import, view/download/delete data, locality fix). Added RCA Management endpoints (, , ). Added Analytics Dashboards endpoints (, ). Implemented App Settings toggle (). Added User Activity Analytics endpoints (, , ). Added document upload and OCR scanning endpoints for Driver Leads. Fixed  function logic, removed duplicate stats endpoint, fixed driver onboarding sync logic, and corrected role checking.
-   ****: Pydantic data models.
    -   **Summary**: Defines data structures for the application.
    -   **Changes**:  model expanded with new fields (e.g., , ). Added , , ,  models. New models for app settings, activity logs, and RCA update requests.
-   ****: Backend environment variables.
    -   **Summary**: Configuration for backend services.
    -   **Changes**: Added , , and .
-   ****: Python dependencies.
    -   **Summary**: Lists all required Python packages.
    -   **Changes**: Added , , , , , usage: openai [-h] [-v] [-b API_BASE] [-k API_KEY] [-p PROXY [PROXY ...]]
              [-o ORGANIZATION] [-t {openai,azure}]
              [--api-version API_VERSION] [--azure-endpoint AZURE_ENDPOINT]
              [--azure-ad-token AZURE_AD_TOKEN] [-V]
              {api,tools,migrate,grit} ...

positional arguments:
  {api,tools,migrate,grit}
    api                 Direct API calls
    tools               Client side tools for convenience

options:
  -h, --help            show this help message and exit
  -v, --verbose         Set verbosity.
  -b API_BASE, --api-base API_BASE
                        What API base url to use.
  -k API_KEY, --api-key API_KEY
                        What API key to use.
  -p PROXY [PROXY ...], --proxy PROXY [PROXY ...]
                        What proxy to use.
  -o ORGANIZATION, --organization ORGANIZATION
                        Which organization to run as (will use your default
                        organization if not specified)
  -t {openai,azure}, --api-type {openai,azure}
                        The backend API to call, must be `openai` or `azure`
  --api-version API_VERSION
                        The Azure API version, e.g.
                        'https://learn.microsoft.com/en-us/azure/ai-
                        services/openai/reference#rest-api-versioning'
  --azure-endpoint AZURE_ENDPOINT
                        The Azure endpoint, e.g.
                        'https://endpoint.openai.azure.com'
  --azure-ad-token AZURE_AD_TOKEN
                        A token from Azure Active Directory,
                        https://www.microsoft.com/en-
                        us/security/business/identity-access/microsoft-entra-
                        id
  -V, --version         show program's version number and exit, .
-   ****: Frontend dependencies.
    -   **Summary**: Lists all required Node.js packages.
    -   **Changes**: Added  and .
-   ****: Frontend for driver lead management.
    -   **Summary**: Manages driver lead data entry, display, and imports.
    -   **Changes**: Implemented hierarchical , inline status editing. Added Lead Source and Date to import dialog. Updated UI for multiple import formats. Enhanced driver form to include new fields and document upload/OCR scanning interface for various documents.
-   ****: Main dashboard with sidebar navigation.
    -   **Summary**: Provides main navigation and layout.
    -   **Changes**: Added QR Code Manager, Ride Deck Data Analysis, RCA Management, Analytics Dashboards, App Settings, and User Activity Analytics links to the sidebar. Updated sidebar rendering to group items and apply role-based filtering.
-   ****: Main application routes.
    -   **Summary**: Defines all frontend routes.
    -   **Changes**: Added routes for , , , , , , .
-   ** (NEW file)**:
    -   **Summary**: Comprehensive frontend for Ride Deck Analysis, replacing .
    -   **Changes**: Implemented file upload for customer and ride data, progress bar, display of calculated distances. Added buttons to view, download, and delete backend data with pagination. Included a Fix Localities button to reprocess old data.
-   ** (NEW file)**:
    -   **Summary**: Frontend for Root Cause Analysis (RCA) tables.
    -   **Changes**: Contains UI for Cancellation RCA and Driver_Not_Found RCA tables with dropdowns for Status Reason and conditional Status Detail input.
-   ** (NEW file)**:
    -   **Summary**: Frontend for interactive pivot table dashboards.
    -   **Changes**: Contains UI for Ride Status and SignUps pivot tables with filtering and aggregation options.
-   ****: Frontend for payment data extraction.
    -   **Summary**: Manages payment screenshot uploads and processing.
    -   **Changes**: Implemented logic to check app status via backend, display a notification banner when disabled, and hide the entire app content when disabled. Restricted 'modify amount' and 'modify rows' (editing) functionality based on user roles (only for Admins/Master Admins).
-   ** (NEW file)**:
    -   **Summary**: Frontend page for Master Admins to toggle application settings.
    -   **Changes**: Contains a switch to enable/disable the Payment Data Extractor app.
-   ** (NEW file)**:
    -   **Summary**: Frontend page for viewing user activity logs and live feed.
    -   **Changes**: Placeholder for displaying historical user actions and current app usage.
-   ** /  (NEW file)**:
    -   **Summary**: Google Apps Script for two-way sync with Driver Onboarding leads.
    -   **Changes**: Updated column mapping to include all 28 new fields. Added  to the configuration. New file  created with updated script and comprehensive setup instructions ().
</code_architecture>

<pending_tasks>
-   Fully implement the remaining features for the Expense Tracker mini-app.
-   Complete the OCR scanning data extraction for Driver Onboarding documents, ensuring extracted data populates form fields.
-   Investigate and fix the Payment Data Extractor app failing to process 10 screenshots after 3 minutes.
</pending_tasks>

<current_work>
The AI engineer was immediately working on debugging an issue reported by the user concerning the Payment Data Extractor app. The user reported that after uploading 10 screenshots (including a WhatsApp Image 2025-10-01 at 7.07.10 AM.jpeg), the processing failed after 3 minutes. The AI engineer has analyzed the provided screenshot, noting it was a ride history screenshot rather than a payment one, and has identified the next step as investigating the Payment Data Extractor code to understand the failure after the 3-minute timeout. This indicates the engineer is actively troubleshooting a performance or processing error within the Payment Data Extractor feature.
</current_work>

<optional_next_step>
Investigate the  code for the Payment Data Extractor to identify why it's failing after 3 minutes with 10 images.
</optional_next_step>
